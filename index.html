<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Login System</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <h1>Login / Signup System</h1>

  <div id="auth-section">
    <h2>Sign Up</h2>
    <input type="text" id="signup-username" placeholder="Username"><br>
    <input type="password" id="signup-password" placeholder="Password"><br>
    <button onclick="signUp()">Sign Up</button>

    <h2>Login</h2>
    <input type="text" id="login-username" placeholder="Username"><br>
    <input type="password" id="login-password" placeholder="Password"><br>
    <button onclick="login()">Login</button>
  </div>

  <div id="user-section" style="display: none;">
    <h2>Welcome, <span id="current-user"></span>!</h2>
    <button onclick="logout()">Logout</button>
  </div>

  <script>
    const supabaseUrl = 'https://zgntqxmctaeanerzncbu.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpnbnRxeG1jdGFlYW5lcnpuY2J1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg3MTA5MjQsImV4cCI6MjA2NDI4NjkyNH0.yC1slPrw8wosSTKpHoYXWtFcIoTbcmplU9pYX9buWmM';
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);

    let currentUser = null;

    async function signUp() {
      const username = document.getElementById('signup-username').value;
      const password = document.getElementById('signup-password').value;

      if (!username || !password) return alert("Both fields are required.");

      // Check if user exists
      const { data: existing, error: existError } = await supabase
        .from('user')
        .select('*')
        .eq('username', username)
        .single();

      if (existing) {
        alert("Username already taken.");
        return;
      }

      const { data, error } = await supabase.from('user').insert([{ username, password }]);
      if (error) {
        alert("Signup failed.");
        console.error(error);
      } else {
        alert("Signup successful. Please login.");
      }
    }

    async function login() {
      const username = document.getElementById('login-username').value;
      const password = document.getElementById('login-password').value;

      const { data, error } = await supabase
        .from('user')
        .select('*')
        .eq('username', username)
        .eq('password', password)
        .single();

      if (error || !data) {
        alert("Invalid credentials.");
        return;
      }

      currentUser = data;
      document.getElementById('auth-section').style.display = 'none';
      document.getElementById('user-section').style.display = 'block';
      document.getElementById('current-user').textContent = currentUser.username;
    }

    function logout() {
      currentUser = null;
      document.getElementById('auth-section').style.display = 'block';
      document.getElementById('user-section').style.display = 'none';
      document.getElementById('login-username').value = '';
      document.getElementById('login-password').value = '';
    }
  </script>
</body>
</html>
